name: Mirror to GitVerse

on:
  push:
    branches: [ main, master ]
    tags: [ '*' ]
  release:
    types: [published, edited]
  workflow_dispatch:

jobs:
  mirror:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v3
      with:
        fetch-depth: 0
        fetch-tags: true
    
    - name: Push to GitVerse
      run: |
        git remote add gitverse https://${{ secrets.GITVERSE_TOKEN }}@gitverse.ru/Katerok27153/study_2025-2026_net-admin.git
        git push --mirror gitverse
    
    - name: Create Release on GitVerse
      if: github.event_name == 'release'
      env:
        GITVERSE_TOKEN: ${{ secrets.GITVERSE_TOKEN }}
      run: |
        TAG="${{ github.event.release.tag_name }}"
        NAME="${{ github.event.release.name }}"
        BODY="${{ github.event.release.body }}"
        
        # Создаем релиз на GitVerse через их API
        curl -X POST "https://gitverse.ru/api/v1/repos/Katerok27153/study_2025-2026_net-admin/releases" \
          -H "Authorization: token $GITVERSE_TOKEN" \
          -H "Content-Type: application/json" \
          -d "{
            \"tag_name\": \"$TAG\",
            \"name\": \"$NAME\",
            \"body\": \"$BODY\"
          }"
        
        echo "✅ Релиз $TAG создан на GitVerse"
